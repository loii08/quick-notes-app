<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Loading Animation</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#7c5cff;
      --accent-2:#00d4ff;
      --muted:#98a0b3;
      --size:160px;
      --thickness:12px;
      --glow: 0 10px 30px rgba(124,92,255,0.12);
      --glass: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      display:grid;
      place-items:center;
      font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,92,255,0.06), transparent),
                  radial-gradient(900px 400px at 90% 90%, rgba(0,212,255,0.03), transparent),
                  var(--bg);
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:32px;
    }

    .card{
      width: min(520px, 92vw);
      padding:28px;
      border-radius:18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)),
        rgba(255,255,255,0.02);
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      display:flex;
      gap:18px;
      align-items:center;
    }

    .left{
      width: calc(var(--size) + 12px);
      height: calc(var(--size) + 12px);
      display:grid;
      place-items:center;
    }

    .loader {
      width: var(--size);
      height: var(--size);
      position:relative;
      cursor: pointer;
      user-select: none;
    }

    svg {
      width:100%;
      height:100%;
      display:block;
      transform: rotate(-90deg);
      filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6));
    }

    /* track */
    .ring-track {
      stroke: rgba(255,255,255,0.06);
      stroke-width: var(--thickness);
      fill: none;
    }

    /* progress gradient stroke via mask + stroke-dasharray controlled by JS/CSS var */
    .ring-progress {
      stroke-linecap: round;
      stroke-width: var(--thickness);
      fill:none;
      stroke: url(#grad);
      transition: stroke-dashoffset 420ms cubic-bezier(.2,.9,.28,1);
      transform-origin: 50% 50%;
    }

    /* center label */
    .center {
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      pointer-events:none;
      text-align:center;
    }
    .percent {
      font-size: clamp(18px, 3vw, 24px);
      font-weight:600;
      letter-spacing:0.2px;
    }
    .label {
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }

    /* subtle shimmering on hover */
    .loader:hover .ring-progress {
      transform: scale(1.03);
      transition: transform 300ms;
      filter: drop-shadow(0 10px 28px rgba(124,92,255,0.18));
    }

    /* small controls / info */
    .meta{
      flex:1;
      min-width:0;
    }
    h1{
      margin:0 0 6px 0;
      font-size:18px;
      letter-spacing:-0.2px;
    }
    p{
      margin:0 0 14px 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.3;
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    button{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.04);
      color:var(--muted);
      padding:8px 12px;
      border-radius:10px;
      font-size:13px;
      cursor:pointer;
      transition: all 180ms;
      backdrop-filter: blur(6px);
    }
    button.primary{
      background: linear-gradient(180deg, rgba(124,92,255,0.12), rgba(0,0,0,0.04));
      color: white;
      border: 1px solid rgba(124,92,255,0.22);
      box-shadow: var(--glow);
    }
    button:active{ transform: translateY(1px) scale(.998) }

    small.hint{
      display:block;
      color:var(--muted);
      font-size:12px;
      margin-top:10px;
    }

    /* accessibility: reduce motion */
    @media (prefers-reduced-motion: reduce) {
      .ring-progress {
        transition: none !important;
      }
    }

    /* tiny responsive adjustments */
    @media (max-width:420px){
      .card{ padding:18px; gap:12px; border-radius:14px }
      :root{ --size:132px; }
    }
  </style>
</head>
<body>
  <main class="card" role="main">
    <div class="left">
      <div class="loader" id="loader" role="img" aria-label="Loading progress. Click to toggle mode.">
        <svg viewBox="0 0 120 120" aria-hidden="true">
          <defs>
            <linearGradient id="grad" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#7c5cff" />
              <stop offset="50%" stop-color="#5fe3ff" />
              <stop offset="100%" stop-color="#00d4ff" />
            </linearGradient>
          </defs>

          <!-- outer track -->
          <circle class="ring-track" cx="60" cy="60" r="44"></circle>

          <!-- animated progress ring -->
          <circle class="ring-progress" id="progressRing" cx="60" cy="60" r="44"
                  stroke-dasharray="276.46" stroke-dashoffset="276.46"></circle>

          <!-- small moving orb -->
          <circle id="orb" cx="104" cy="60" r="3.5" fill="#fff" opacity="0.95" />
        </svg>

        <div class="center" aria-hidden="true">
          <div>
            <div class="percent" id="percentText">0%</div>
            <div class="label">Interactive loader</div>
          </div>
        </div>
      </div>
    </div>

    <section class="meta" aria-label="Loader controls">
      <h1>Interactive Loading Animation</h1>
      <p>Move your mouse over the loader to control progress. Click to toggle between indeterminate (spinning) and determinate (mouse-driven) modes. It's accessible and respects <code>prefers-reduced-motion</code>.</p>

      <div class="controls">
        <button id="toggleBtn" class="primary">Switch to Indeterminate</button>
        <button id="resetBtn">Reset</button>
        <button id="demoBtn">Simulate Load</button>
      </div>

      <small class="hint">Tip: drag your mouse over the circular loader to update percentage. Click the loader to toggle mode.</small>
    </section>
  </main>

  <script>
    // Config + DOM
    const ring = document.getElementById('progressRing');
    const orb = document.getElementById('orb');
    const percentText = document.getElementById('percentText');
    const loader = document.getElementById('loader');
    const toggleBtn = document.getElementById('toggleBtn');
    const resetBtn = document.getElementById('resetBtn');
    const demoBtn = document.getElementById('demoBtn');

    const R = 44; // radius in SVG units (matches CSS SVG)
    const C = 2 * Math.PI * R; // circumference ~ 276.46
    ring.style.strokeDasharray = C;
    ring.style.strokeDashoffset = C;

    let mode = 'determinate'; // or 'indeterminate'
    let progress = 0; // 0..1
    let spinning = null; // interval for indeterminate

    // helper to set visual state
    function setProgress(p) {
      p = Math.max(0, Math.min(1, p));
      progress = p;
      const offset = C * (1 - p);
      ring.style.strokeDashoffset = offset;
      percentText.textContent = Math.round(p * 100) + '%';

      // position orb along circle (SVG coordinates)
      const angle = -Math.PI / 2 + (2 * Math.PI * p); // start top and progress clockwise
      const cx = 60 + R * Math.cos(angle);
      const cy = 60 + R * Math.sin(angle);
      orb.setAttribute('cx', String(cx));
      orb.setAttribute('cy', String(cy));
    }

    // convert mouse position on element to 0..1 along circle
    function pointerToProgress(e) {
      const rect = loader.getBoundingClientRect();
      const x = e.clientX - rect.left - rect.width / 2;
      const y = e.clientY - rect.top - rect.height / 2;
      const angle = Math.atan2(y, x); // -pi..pi with 0 at +x
      // convert so top = 0 and clockwise increasing:
      const normalized = ((angle + Math.PI/2) + 2*Math.PI) % (2*Math.PI);
      return normalized / (2*Math.PI);
    }

    // interactivity
    let isPointerDown = false;
    loader.addEventListener('pointerenter', (e) => {
      if (mode === 'determinate') loader.setPointerCapture?.(e.pointerId);
    });
    loader.addEventListener('pointermove', (e) => {
      if (mode !== 'determinate') return;
      // respond to pointermove whether pressed or not â€” gentle interactive feel
      const p = pointerToProgress(e);
      setProgress(p);
    });
    loader.addEventListener('pointerdown', (e) => {
      isPointerDown = true;
      if (mode === 'determinate') {
        const p = pointerToProgress(e);
        setProgress(p);
      }
    });
    window.addEventListener('pointerup', () => { isPointerDown = false; });

    // click toggles mode
    loader.addEventListener('click', toggleMode);

    function toggleMode() {
      if (mode === 'determinate') startIndeterminate();
      else stopIndeterminate();
    }

    function startIndeterminate(){
      mode = 'indeterminate';
      toggleBtn.textContent = 'Switch to Determinate';
      // spin: animate dashoffset in loop and animate orb opacity/position
      let t = 0;
      if (spinning) clearInterval(spinning);
      spinning = setInterval(()=> {
        t += 0.02;
        // create nice eased oscillation for the visible arc length
        const arc = 0.15 + 0.2 * Math.abs(Math.sin(t * 2.3));
        // animate dashoffset to give rotation feel
        const offset = C * (1 - arc) * (0.5 + 0.5 * Math.sin(t * 1.7));
        ring.style.strokeDashoffset = offset;
        // orb orbit
        const angle = -Math.PI/2 + (t * 2.0);
        const cx = 60 + R * Math.cos(angle);
        const cy = 60 + R * Math.sin(angle);
        orb.setAttribute('cx', String(cx));
        orb.setAttribute('cy', String(cy));
        // label shows 'Loading' with animated dots
        percentText.textContent = 'Loading' + '.'.repeat(Math.floor((t*3)%4));
      }, 16);
    }

    function stopIndeterminate(){
      mode = 'determinate';
      toggleBtn.textContent = 'Switch to Indeterminate';
      if (spinning) clearInterval(spinning);
      spinning = null;
      setProgress(progress); // restore last numeric display
    }

    // controls
    toggleBtn.addEventListener('click', (e)=>{
      e.stopPropagation();
      toggleMode();
    });

    resetBtn.addEventListener('click', ()=>{
      stopIndeterminate();
      setProgress(0);
    });

    // simulate a real load: increments progress over time
    demoBtn.addEventListener('click', async ()=>{
      stopIndeterminate();
      setProgress(0.02);
      demoBtn.disabled = true;
      for (let i = 0; i <= 100; i++) {
        await new Promise(r => setTimeout(r, 18 + Math.random()*60));
        setProgress(i/100);
      }
      demoBtn.disabled = false;
    });

    // initialize
    setProgress(0.15);

    // respect prefers-reduced-motion: if user prefers reduced motion, avoid spin
    const prm = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');
    if (prm && prm.matches) {
      // disable indeterminate auto behavior and keep determinate only
      toggleBtn.style.display = 'none';
    }

    // keyboard accessibility: space toggles, left/right adjust
    loader.setAttribute('tabindex', '0');
    loader.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter') { e.preventDefault(); toggleMode(); }
      if (mode === 'determinate') {
        if (e.key === 'ArrowRight') setProgress(progress + 0.05);
        if (e.key === 'ArrowLeft') setProgress(progress - 0.05);
      }
    });

  </script>
</body>
</html>
